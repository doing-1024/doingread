<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title></title>
    <style>
      .navbar {
        position: fixed;
        top: -60px;
        left: 0;
        right: 0;
        height: 60px;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(10px);
        display: flex;
        align-items: center;
        padding: 0 20px;
        transition: top 0.3s ease;
        z-index: 1000;
      }
      .navbar.show {
        top: 0;
      }
      .navbar a {
        color: #fff;
        text-decoration: none;
        padding: 8px 16px;
        border-radius: 4px;
        transition: background 0.2s;
      }
      .navbar a:hover {
        background: rgba(255, 255, 255, 0.1);
      }
      .settings-icon {
        position: fixed;
        top: 20px;
        right: 20px;
        width: 40px;
        height: 40px;
        background: rgba(0, 0, 0, 0.8);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        cursor: pointer;
        backdrop-filter: blur(10px);
        transition: 0.3s;
        z-index: 1001;
        color: #fff;
      }
      .settings-icon:hover {
        transform: rotate(90deg);
        background: rgba(0, 0, 0, 0.9);
      }
    </style>
  </head>
  <body
    style="
      height: 100vh;
      background: #000;
      color: #fff;
      margin: 0;
      overflow: hidden;
    "
  >
    <nav class="navbar" id="navbar">
      <a href="/">← 返回首页</a>
      <span id="articleTitle" style="flex: 1; text-align: center; font-weight: 500;"></span>
    </nav>
    
    <div class="settings-icon" onclick="showSettings()">⚙️</div>
    
    <div
      style="
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100%;
        font-size: 50px;
        text-align: center;
        padding: 0 20px;
      "
    >
      <p class="text"></p>
    </div>
    <script>
      // 导航栏自动隐藏/显示
      let navbar = document.getElementById('navbar');
      let showTimeout;
      
      document.addEventListener('mousemove', function(e) {
        if (e.clientY <= 50) {
          navbar.classList.add('show');
          clearTimeout(showTimeout);
        } else {
          showTimeout = setTimeout(() => {
            navbar.classList.remove('show');
          }, 2000);
        }
      });

      function getQueryVariable(variable) {
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i = 0; i < vars.length; i++) {
          var pair = vars[i].split("=");
          if (pair[0] == variable) {
            return pair[1];
          }
        }
        return false;
      }
      let area = document.getElementsByClassName("text")[0];
      area.style.opacity = "0";
      let id = getQueryVariable("id");
      let longText = "";
      let articles = JSON.parse(localStorage.getItem("articles"));
      for (let i = 0; i < articles.length; ++i)
        if (articles[i].id == id) {
          longText = articles[i].content;
          document.title = articles[i].title + " —— 行读";
          document.getElementById('articleTitle').textContent = articles[i].title;
          break;
        }
      // --- 文本分割逻辑 ---
      function splitText(text) {
        // 使用正则表达式分割：支持中文/英文的 逗号、句号、感叹号、问号、换行符
        // filter(s => s.trim() !== "") 用于去除空行
        return text
          .split(/[，。！：：；；？\n,.\!\?]/)
          .map((s) => s.trim())
          .filter((s) => s.length > 0);
      }

      let text_list = splitText(longText);

      // --- 动画逻辑 (保留你原始的逻辑) ---
      let tick = 15;
      // tick 20 意味着渐变 100 步需要 2000ms (2秒)
      // 整个淡入淡出周期是 4000ms (4秒)

      for (let i = 0; i < text_list.length; ++i) {
        // 设置文字内容
        setTimeout(
          () => {
            area.innerText = text_list[i];
          },
          i * tick * 200 + (i + 1) * 1000,
        );

        // 淡入动画 (0 -> 1)
        for (let j = 0; j <= 100; ++j)
          setTimeout(
            () => {
              area.style.opacity = String(j * 0.01);
            },
            i * tick * 200 + j * tick + (i + 1) * 1000,
          );

        // 淡出动画 (1 -> 0)
        for (let j = 0; j <= 100; ++j)
          setTimeout(
            () => {
              area.style.opacity = String((100 - j) * 0.01);
            },
            i * tick * 200 + tick * 100 + j * tick + (i + 1) * 1000,
          );
      }
      
      function showSettings() {
        alert('设置功能待开发');
      }
    </script>
  </body>
</html>
