<!doctype html>
<html>
  <head>
    <title>行读</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://lib.webstatic.cn/ajax/jquery/3.5.1/jquery.min.js"></script>
    <style>
      :root {
        --bg-color: #f5f7fa;
        --text-color: #2c3e50;
        --card-bg: white;
        --border-color: #ddd;
        --preview-color: #7f8c8d;
      }
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: var(--bg-color);
        color: var(--text-color);
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
      }
      @media (max-width: 768px) {
        .container {
          padding: 15px;
        }
        .header {
          padding: 25px;
        }
        .header h1 {
          font-size: 28px;
          margin-bottom: 15px;
        }
        .add-btn {
          padding: 15px 25px;
          font-size: 16px;
        }
        .articles {
          grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
          gap: 18px;
          padding: 18px;
        }
        .article {
          padding: 18px;
        }
        .article-title {
          font-size: 16px;
        }
        .article-preview {
          font-size: 14px;
        }
        .settings-icon {
          width: 45px;
          height: 45px;
          font-size: 20px;
        }
        .modal-content {
          width: 90%;
          max-width: 400px;
          padding: 25px;
        }
        .delete-btn {
          padding: 8px 12px;
          font-size: 14px;
        }
      }
      .header {
        background: var(--card-bg);
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
        text-align: center;
      }
      .header h1 {
        color: var(--text-color);
        font-size: 28px;
        margin-bottom: 15px;
      }
      .add-btn {
        background: #3498db;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-size: 16px;
        cursor: pointer;
        transition: 0.3s;
      }
      .add-btn:hover {
        background: #2980b9;
      }
      .articles {
        background: var(--bg-color);
        border-radius: 12px;
        padding: 20px;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 20px;
      }
      .articles h3 {
        color: var(--text-color);
        margin-bottom: 15px;
        grid-column: 1 / -1;
      }
      .article {
        background: var(--card-bg);
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        transition: 0.3s;
        aspect-ratio: 2/3;
        display: flex;
        flex-direction: column;
      }
      .article:hover {
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      }
      .article-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 15px;
      }
      .article-title {
        font-size: 16px;
        color: var(--text-color);
        text-decoration: none;
        font-weight: 600;
        line-height: 1.3;
      }
      .article-title:hover {
        color: #3498db;
      }
      .article-preview {
        color: var(--preview-color);
        font-size: 13px;
        line-height: 1.4;
        flex-grow: 1;
        overflow: hidden;
      }
      .delete-btn {
        background: #e74c3c;
        color: white;
        border: none;
        padding: 4px 8px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
        flex-shrink: 0;
      }
        cursor: pointer;
      }
      .delete-btn:hover {
        background: #c0392b;
      }
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
      }
      .modal-content {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: var(--card-bg);
        padding: 30px;
        border-radius: 12px;
        width: 400px;
      }
      .modal h3 {
        margin-bottom: 20px;
        color: var(--text-color);
      }
      .form-group {
        margin-bottom: 15px;
      }
      .form-group input {
        width: 100%;
        padding: 10px;
        border: 1px solid var(--border-color);
        border-radius: 6px;
        font-size: 14px;
        background: var(--card-bg);
        color: var(--text-color);
      }
      .form-group select {
        width: 100%;
        padding: 10px;
        border: 1px solid var(--border-color);
        border-radius: 6px;
        font-size: 14px;
        background: var(--card-bg);
        color: var(--text-color);
      }
      .form-group label {
        display: block;
        margin-bottom: 5px;
        color: var(--text-color);
        font-weight: 500;
      }
      .form-buttons {
        display: flex;
        gap: 10px;
        justify-content: flex-end;
        margin-top: 20px;
      }
      .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
      }
      .btn-primary {
        background: #3498db;
        color: white;
      }
      .btn-secondary {
        background: #95a5a6;
        color: white;
      }
      .btn:hover {
        opacity: 0.9;
      }
      .empty-state {
        text-align: center;
        color: var(--preview-color);
        padding: 40px;
      }
      .settings-icon {
        position: fixed;
        top: 20px;
        right: 20px;
        width: 40px;
        height: 40px;
        background: var(--card-bg);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        cursor: pointer;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        transition: 0.3s;
        z-index: 999;
      }
      .settings-icon:hover {
        transform: rotate(90deg);
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>行读</h1>
        <button class="add-btn" onclick="showModal()">添加文章</button>
      </div>
      
      <div class="settings-icon" onclick="showSettings()">⚙️</div>

      <div class="articles" id="articleList">
        <h3>文章列表</h3>
      </div>
    </div>

    <div class="modal" id="modal">
      <div class="modal-content">
        <h3>添加新文章</h3>
        <div class="form-group">
          <input type="file" id="fileInput" accept=".txt" onchange="autoFillTitle()" />
        </div>
        <div class="form-group">
          <input type="text" id="titleInput" placeholder="请输入文章名称" />
        </div>
        <div class="form-buttons">
          <button class="btn btn-secondary" onclick="hideModal()">取消</button>
          <button class="btn btn-primary" onclick="addArticle()">
            确认添加
          </button>
        </div>
      </div>
    </div>

    <script>
      $(document).ready(function() {
        function showModal() {
          $('#modal').show();
        }

        function hideModal() {
          $('#modal').hide();
          $('#fileInput').val('');
          $('#titleInput').val('');
        }

        function autoFillTitle() {
          const file = $('#fileInput')[0].files[0];
          if (file) {
            const nameWithoutExt = file.name.replace(/\.[^/.]+$/, "");
            $('#titleInput').val(nameWithoutExt);
          }
        }

        function loadArticles() {
          const articles = JSON.parse(localStorage.getItem('articles') || '[]');
          const $list = $('#articleList');
          
          if (articles.length === 0) {
            $list.html('<h3>文章列表</h3><div class="empty-state">暂无文章，点击上方按钮添加</div>');
            return;
          }
          
          $list.html('<h3>文章列表</h3>');
          articles.forEach((article, index) => {
            const preview = article.content.substring(0, 100).replace(/\n/g, ' ') + '...';
            $list.append(`
              <div class="article">
                <div class="article-header">
                  <a href="/read/?id=${article.id}" class="article-title">${article.title}</a>
                  <button class="delete-btn" onclick="deleteArticle(${index})">删除</button>
                </div>
                <div class="article-preview">${preview}</div>
              </div>
            `);
          });
        }

        function addArticle() {
          const file = $('#fileInput')[0].files[0];
          const title = $('#titleInput').val().trim();
          
          if (!file || !title) {
            alert('请选择文件并输入文章名称');
            return;
          }
          
          const reader = new FileReader();
          reader.onload = function(e) {
            const articles = JSON.parse(localStorage.getItem('articles') || '[]');
            const newArticle = {
              id: Date.now().toString(),
              title: title,
              content: e.target.result,
              createdAt: new Date().toISOString()
            };
            articles.push(newArticle);
            localStorage.setItem('articles', JSON.stringify(articles));
            hideModal();
            loadArticles();
          };
          reader.readAsText(file);
        }

        window.deleteArticle = function(index) {
          if (confirm('确定要删除这篇文章吗？')) {
            const $article = $(`.article:eq(${index})`);
            $article.fadeOut(300, function() {
              const articles = JSON.parse(localStorage.getItem('articles') || '[]');
              articles.splice(index, 1);
              localStorage.setItem('articles', JSON.stringify(articles));
              loadArticles();
            });
          }
        }

        function showSettings() {
          $('#settingsModal').show();
          loadSettings();
        }

        function hideSettings() {
          $('#settingsModal').hide();
        }

        function loadSettings() {
          const theme = localStorage.getItem('theme') || 'light';
          $('#themeSelect').val(theme);
        }

        function changeTheme() {
          const theme = $('#themeSelect').val();
          localStorage.setItem('theme', theme);
          applyTheme(theme);
        }

        function applyTheme(theme) {
          const root = document.documentElement;
          if (theme === 'dark') {
            root.style.setProperty('--bg-color', '#1a1a1a');
            root.style.setProperty('--text-color', '#ffffff');
            root.style.setProperty('--card-bg', '#2d2d2d');
            root.style.setProperty('--border-color', '#404040');
            root.style.setProperty('--preview-color', '#b0b0b0');
          } else {
            root.style.setProperty('--bg-color', '#f5f7fa');
            root.style.setProperty('--text-color', '#2c3e50');
            root.style.setProperty('--card-bg', 'white');
            root.style.setProperty('--border-color', '#ddd');
            root.style.setProperty('--preview-color', '#7f8c8d');
          }
        }

        function initTheme() {
          const theme = localStorage.getItem('theme') || 'light';
          applyTheme(theme);
        }

        // 绑定事件
        window.showModal = showModal;
        window.hideModal = hideModal;
        window.addArticle = addArticle;
        window.showSettings = showSettings;
        window.hideSettings = hideSettings;
        window.changeTheme = changeTheme;
        
        $('#fileInput').on('change', autoFillTitle);

        initTheme();
        loadArticles();
      });
    </script>
    <div class="modal" id="settingsModal">
      <div class="modal-content">
        <h3>设置</h3>
        <div class="form-group">
          <label>主题模式</label>
          <select id="themeSelect" onchange="changeTheme()">
            <option value="light">浅色模式</option>
            <option value="dark">深色模式</option>
          </select>
        </div>
        <div class="form-buttons">
          <button class="btn btn-secondary" onclick="hideSettings()">关闭</button>
        </div>
      </div>
    </div>
  </body>
</html>
